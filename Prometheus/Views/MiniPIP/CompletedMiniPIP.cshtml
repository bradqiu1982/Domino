@model IEnumerable<IEnumerable<Domino.Models.DominoVM>>

@{
    ViewBag.Title = "CompletedMiniPIP";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <div class="col-lg-3">
        <h2>Completed MiniPIP Board</h2>
    </div>
    <div class="col-lg-3">
        <button data-toggle="tooltip" title="Working MiniPIP" type="button" onclick="WorkingMiniPIP()" class="btn btn-default" style="font-size:1.5em; margin-top: 0.83em;margin-bottom: 0.83em;width:100%;">Working MiniPIP</button>
    </div>
    <div class="col-lg-6"></div>
    <script type="text/javascript">
        function WorkingMiniPIP()
        {
            window.location.href = '/Domino/MiniPIP/ViewAll';
        }
    </script>
</div>

@if (ViewBag.badmin != null && ViewBag.badmin)
{
<hr/>
<div class="row col-lg-12">

        <div class="col-lg-2">
            <label class="control-label">ECONum Filter:</label>
        </div>
        <div class="col-lg-3">
            <input class="form-control text-box single-line" typeof="text" value="" id="ECONumFilter" name="ECONumFilter" />
        </div>
        <div class="col-lg-1">
            <button data-toggle="tooltip" title="ECO Num Filter" type="button" class="btn btn-default" onclick="FilterECONum()"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
        </div>

        @if (ViewBag.FilterPEList != null)
        {
            <div class="col-lg-2">
                <label class="control-label" for="FilterPEList">PE Filter:</label>
            </div>
                <div class="col-lg-4">
                    @Html.DropDownList("FilterPEList", null, new { @id = "FilterPEList", @class = "form-control", @onchange = "ShowPEWorkingMiniPIP()" })
                </div>
        }
        else
        {
            <div class="col-lg-6"></div>
        }


    <script type="text/javascript">
            function ShowPEWorkingMiniPIP() {
                if (document.getElementById("FilterPEList").value && document.getElementById("FilterPEList").value != 'NONE')
                {
                    window.location.href = '/Domino/MiniPIP/ShowPECompletedMiniPIP?PE=' + document.getElementById("FilterPEList").value;
                }
            }

            function FilterECONum()
            {
                if (document.getElementById("ECONumFilter").value)
                {
                    window.location.href = '/Domino/MiniPIP/ShowECOMiniPIP?ECONum=' + document.getElementById("ECONumFilter").value;
                }
            }
    </script>
</div>
}

<hr />

@if (Model != null)
{
    foreach (var item in Model)
    {
        if (item.Count() > 0)
        {
            var keyvals = Domino.Models.ECOBaseInfo.RetrieveBaseInfoKV4ViewAll(item.ElementAt(0).EBaseInfo);
            <div class="row">
                <div class="col-lg-12">
                    @foreach (var kvp in keyvals)
                        {

                        <div class="col-lg-2">
                            <div class="col-lg-11">
                                <div class="panel panel-default" style="height:60px;width:180px;">
                                    <div class="panel-heading  panel-heading-info" style="height:28px;">
                                        <div class="text-center" style="font-size:10px">
                                            <strong>
                                                @kvp.Key
                                            </strong>
                                        </div>
                                    </div>

                                    <div class="panel-body panel-body-info" style="height:32px;">
                                        <div class="text-center" style="font-size:11px">
                                            @if (string.Compare(kvp.Key.ToUpper(), "ECO STATUS") == 0)
                                            {
                                                <font color="red"><strong>@kvp.Value.ToUpper()</strong></font>
                                            }
                                            else
                                            {
                                                <strong>@kvp.Value</strong>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-1"></div>
                        </div>
                    }
                </div>
            </div>
        }

        <div class="row">
            <div class="col-lg-12">
                @foreach (var card in item)
                    {
                    <div class="col-lg-1 divclickable" CardType="@card.CardType" ECOKey="@card.ECOKey" CardKey="@card.CardKey">
                        <div class="col-lg-11">
                            <div class="panel panel-default" style="height:100px;width:90px;">
                                <div class="panel-heading  panel-heading-@card.CardStatus" style="height:30px;">
                                    <div class="text-right">
                                        @card.CardNo
                                    </div>
                                </div>
                                <div class="panel-body panel-body-@card.CardStatus" style="height:70px;">
                                    <div class="row col-lg-12 text-center" style="font-size:11px">
                                        <strong>
                                            @card.CardContent
                                        </strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-1"></div>
                    </div>
                }
            </div>
        </div>
            <hr />
    }
}

<script type="text/javascript">
                $(document).ready(function () {
                    $('.divclickable').click(function () {
                        var cardtype = this.getAttribute("CardType");
                        var ecokey = this.getAttribute("ECOKey");
                        var cardkey = this.getAttribute("CardKey");

                        if (cardtype && cardkey && ecokey) {
                            window.location.href = '/Domino/MiniPIP/' + cardtype + '?ECOKey=' + ecokey + '&CardKey=' + cardkey;
                        }
                    });
                });
</script>
